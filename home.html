<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
</head>
<body>
    <h1>Home Page</h1>
    <h2 style="color: green;"> Successfully Authenticated !</h2>    
    <h4> id_token: </h4>
    <div id="idtoken" style="max-width: 400px;line-break:anywhere;"></div><br>
    <h4> decoded token: </h4>    
    <div id="decodedToken" style="max-width: 400px;line-break:anywhere;"></div><br>
    <button onclick="gotoJWTIO()">View in jwt.io</button>

    <script src="https://cdn.jsdelivr.net/npm/@zedeid-sdk/zedeid-did-siop-lib@0.0.9-10/dist/index.min.js"></script>    
    <script>
        console.log(document.location.hash);
        let siop_rp = null;        
        let resJWT = document.location.hash.substr(1);
        document.getElementById('idtoken').innerHTML = resJWT;

        processJWT(resJWT);
    
        async function processJWT(jwt){        
            const relyingParty = new DID_SIOP.RP(redirect_uri,did,kid,privateKey);
            await relyingParty.init();
            let valid = await relyingParty.validateResponse(resJWT);
            console.log('Response validated...');
            console.log('Validated response',valid); 
            document.getElementById('decodedToken').innerHTML = JSON.stringify(valid);        
        }

        function gotoJWTIO(){
            var url =  `http://www.jwt.io/?id_token=${resJWT}`;
            window.open(url, '_blank');
        }

        </script>
</body>
</html>
